<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Quiver Hub - Admin Chat</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; background-color: #f5f5f5; }
    h1 { padding: 16px; margin: 0; background-color: #333; color: white; font-size: 1.2em; }
    #messages { list-style-type: none; margin: 0; padding: 12px; flex-grow: 1; overflow-y: auto; display: flex; flex-direction: column; }
    #messages li { padding: 8px 12px; margin-bottom: 8px; border-radius: 12px; max-width: 70%; word-wrap: break-word; }
    .PLAYER { background-color: #e0e0e0; align-self: flex-start; }
    .ADMIN { background-color: #1a73e8; color: white; align-self: flex-end; }
    #form { display: flex; padding: 12px; border-top: 1px solid #ccc; background-color: #fff; }
    #input { border: 1px solid #ccc; border-radius: 18px; padding: 10px; flex-grow: 1; margin-right: 8px; }
    button { background: #1a73e8; color: white; border: none; padding: 10px 15px; border-radius: 18px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>Quiver Hub - Admin Chat</h1>
  <ul id="messages"></ul>
  <form id="form" action="">
    <input id="input" autocomplete="off" placeholder="Enter a reply..." /><button>Send</button>
  </form>

  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

  <script type="module">
    // 사용자님의 Firebase 프로젝트 설정 값
    const firebaseConfig = {
      apiKey: "AIzaSyDvU1zZnyk39pbxkbJNWUt93kSnDva3dvM",
      appId: "1:892141263609:web:6be24bfdeb300f1d926028",
      messagingSenderId: "892141263609",
      projectId: "quiver-hub",
      authDomain: "quiver-hub.firebaseapp.com",
      storageBucket: "quiver-hub.appspot.com",
      measurementId: "G-KJQ01Y90VX",
    };

    // Firebase 앱 초기화
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // DOM 요소 가져오기
    const form = document.getElementById('form');
    const input = document.getElementById('input');
    const messages = document.getElementById('messages');

    // 'chats/main_thread/messages' 컬렉션을 실시간으로 감시
    db.collection('chats/main_thread/messages').orderBy('timestamp', 'asc').onSnapshot(querySnapshot => {
      messages.innerHTML = ''; // 기존 메시지 목록 비우기
      querySnapshot.forEach(doc => {
        const data = doc.data();
        const item = document.createElement('li');
        item.textContent = data.text;
        item.classList.add(data.senderType); // PLAYER 또는 ADMIN 클래스 추가
        messages.appendChild(item);
      });
      // 항상 맨 아래로 스크롤
      messages.scrollTop = messages.scrollHeight;
    });

    // 메시지 전송 폼 이벤트 리스너
    form.addEventListener('submit', e => {
      e.preventDefault();
      if (input.value) {
        // Firestore에 메시지 추가 (senderType: 'ADMIN')
        db.collection('chats/main_thread/messages').add({
          text: input.value,
          senderType: 'ADMIN',
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
        input.value = '';
      }
    });
  </script>
</body>
</html>